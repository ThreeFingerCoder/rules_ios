load("@rules_proto_grpc//objc:defs.bzl", "objc_proto_compile")
load("@rules_proto_grpc//internal:filter_files.bzl", "filter_files")
load("//rules:framework.bzl", "apple_framework")

exports_files(["*.proto"])

proto_library(
    name = "sample_proto",
    srcs = ["sample.proto"],
)

objc_proto_compile(
    name = "sample_objc_proto",
    protos = [":sample_proto"],
)

# Filter files to sources and headers
filter_files(
    name = "sample_objc_proto.m",
    extensions = ["m"],
    target = "sample_objc_proto",
)

filter_files(
    name = "sample_objc_proto.h",
    extensions = ["h"],
    target = "sample_objc_proto",
)

apple_framework(
    name = "SampleProtoFramework",
    srcs = [
        ":sample_objc_proto.h",
        ":sample_objc_proto.m",
    ],
    includes = ["sample_objc_proto"],
    platforms = {"ios": "10.0"},
    visibility = ["//visibility:public"],
    deps = ["@com_google_protobuf//:protobuf_objc"],
)
